@using System.Globalization;
@model IEnumerable<gbH60Customer.DTO.JoinProductCartItemDTO>

@{
    ViewData["Title"] = "Cart";
    ViewData["CustId"] = ViewData["CustId"] ?? 0;
    ViewData["SubTotal"] = ViewData["SubTotal"] ?? 0.0;
    ViewData["Taxes"] = ViewData["Taxes"] ?? 0.0;
    ViewData["Total"] = ViewData["Total"] ?? 0.0;
}

<h1>Shopping Cart</h1>

<div id="cartPage">
    <div id="cartItemsDiv">
        @if (Model.Count() > 0)
        {
            @foreach (var item in Model)
            {
                <section class="cartSection">
                    <div>
                        <img alt="@item.Product.Name Image" src="@(item.Product.ImageURL ?? Url.Content("~/images/no_image.png"))" onerror="this.src='/images/no_image.png';this.onerror='';" loading="lazy" />
                    </div>
                    <div>
                        <h3>@Html.DisplayFor(modelItem => item.Product.Name)</h3>
                        <div>
                            <div>
                                @Html.DisplayFor(modelItem => item.Product.Stock) Left in Stock
                            </div>
                            <div id="incDecBtns">
                                <button class="btn" onclick="remOneFromCart(@ViewData["CustId"], @item.Product.ProductId)">&minus;</button>
                                <span>@Html.DisplayFor(modelItem => item.CartItem.Quantity)</span>
                                <button class="btn" onclick="addToCart(@ViewData["CustId"], @item.Product.ProductId)" @(item.Product.Stock < 1 ? "disabled" : "")>&plus;</button>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div>@Html.DisplayFor(modelItem => item.CartItem.Price) (@Html.DisplayFor(modelItem => item.Product.SellPrice) &times; @Html.DisplayFor(modelItem => item.CartItem.Quantity))</div>

                        <div>
                            <a class="btn" asp-controller="Products" asp-action="Details" asp-route-id="@item.Product.ProductId">Details</a>
                            <button class="btn" onclick="delFromCart(@ViewData["CustId"], @item.Product.ProductId)">Remove</button>
                        </div>
                    </div>
                </section>
            }
        }
        else
        {
            <section class="cartSection">
                <h3>Empty Cart!</h3>
            </section>
        }
    </div>

    @if (Model.Any())
    {
        <div id="totalDiv">
            <div><span class="bold">Sub-Total: </span>@(((decimal)(ViewData["SubTotal"])).ToString("C", CultureInfo.CurrentCulture))</div>
            <div><span class="bold">Taxes: </span>@(((decimal)(ViewData["Taxes"])).ToString("C", CultureInfo.CurrentCulture))</div>
            <div><span class="bold">Total: </span>@(((decimal)(ViewData["Total"])).ToString("C", CultureInfo.CurrentCulture))</div>
            <div>
                <a class="btn" asp-action="Checkout">Go to Checkout</a>
            </div>
        </div>
    }
    
</div>